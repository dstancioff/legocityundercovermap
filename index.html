<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>LEGO City Undercover Interactive Map</title>
        <meta name="google-site-verification" content="kI7YRipDOHdpbQRmalk9-9oX0qcrIFSMxyqD2N1OTOY" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.2/gh-fork-ribbon.min.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
           integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
           crossorigin=""/>
        <!-- Make sure you put this AFTER Leaflet's CSS -->
        <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
           integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
           crossorigin=""></script>
        <script>
            var language, debug, tiles;
            var districtLayers = [];
            var activeDistricts = [];
            var districtPointIndex = null;
            var sidebarState = {
                openCategories: {},
                openDistricts: {},
                openEntries: {},
                focusDistrictId: null,
                preFocusView: null,
            };

            function get_show_completed() {
                // Sidebar filter is "Hide completed".
                var hideCompleted = document.getElementById('hideCompleted');
                if (!hideCompleted) return false;
                return !hideCompleted.checked;
            }

            function get_search_query() {
                var el = document.getElementById('sidebarSearch');
                if (!el) return '';
                return (el.value || '').trim().toLowerCase();
            }

            function get_show_districts() {
                var showDistricts = document.getElementById('showDistricts');
                if (!showDistricts) return false;
                return !!showDistricts.checked;
            }

            function get_sidebar_grouping() {
                var active = document.querySelector('.sidebar-tab.is-active');
                if (!active) return 'category';
                return active.getAttribute('data-grouping') || 'category';
            }

            function get_focused_district_id() {
                return sidebarState.focusDistrictId;
            }

            function show_district_validation_badge() {
                var badge = document.getElementById('districtValidationBadge');
                if (!badge) return;
                if (!districtPointIndex || !districtPointIndex.meta || !districtPointIndex.validation) {
                    badge.style.display = 'none';
                    return;
                }

                var unassigned = districtPointIndex.meta.unassigned_point_count || 0;
                var ambiguous = districtPointIndex.meta.ambiguous_point_count || 0;
                if (unassigned == 0 && ambiguous == 0) {
                    badge.style.display = 'none';
                    return;
                }
                badge.style.display = 'inline-flex';
                badge.textContent = 'District data: ' + unassigned + ' unassigned, ' + ambiguous + ' ambiguous';
            }

            function category_title_text(markers, marker_type) {
                if (markers[marker_type]["title"] && language in markers[marker_type]["title"]) {
                    return markers[marker_type]["title"][language];
                }
                return marker_type;
            }

            function normalize_text_case_insensitive(text) {
                return (text || '').toString().trim().toLowerCase();
            }

            function summarize_category_label(label, maxLen) {
                var text = (label || '').toString().trim();
                if (!text) return '';
                if (text.length <= maxLen) return text;

                var words = text.split(/[^A-Za-z0-9]+/).filter(function(w) { return !!w; });
                if (words.length > 1) {
                    var initials = '';
                    for (var i = 0; i < words.length; i++) {
                        initials += words[i].charAt(0).toUpperCase();
                    }
                    if (initials.length >= 2) {
                        return initials.slice(0, maxLen);
                    }
                }

                var compact = text.replace(/[^A-Za-z0-9]/g, '');
                if (!compact) compact = text;
                if (compact.length > maxLen) {
                    compact = compact.charAt(0) + compact.slice(1).replace(/[aeiouAEIOU]/g, '');
                }
                if (compact.length > maxLen) {
                    compact = compact.slice(0, maxLen);
                }
                return compact;
            }

            function sidebar_entry_title_text(markers, marker, marker_type, includeCategoryLabel) {
                var markerTitle = marker_title_text(marker, marker_type);
                if (!includeCategoryLabel) return markerTitle;

                var categoryTitle = category_title_text(markers, marker_type);
                if (normalize_text_case_insensitive(categoryTitle) == normalize_text_case_insensitive(markerTitle)) {
                    return markerTitle;
                }

                var shortCategory = summarize_category_label(categoryTitle, 8);
                if (!shortCategory) return markerTitle;
                return shortCategory + ': ' + markerTitle;
            }

            function get_district_by_id(districtId) {
                for (var i = 0; i < activeDistricts.length; i++) {
                    if (activeDistricts[i].id == districtId) return activeDistricts[i];
                }
                return null;
            }

            function marker_matches_focus(marker) {
                var focusedDistrict = get_focused_district_id();
                if (!focusedDistrict) return true;
                var markerDistrict = marker._district_id ? marker._district_id : '__unassigned';
                return markerDistrict == focusedDistrict;
            }

            function update_district_focus_ui() {
                var clearFocus = document.getElementById('clearDistrictFocus');
                if (!clearFocus) return;

                var focusedDistrict = get_focused_district_id();
                if (!focusedDistrict) {
                    clearFocus.style.display = 'none';
                    return;
                }

                if (focusedDistrict == '__unassigned') {
                    clearFocus.textContent = 'Clear focus: Unassigned';
                } else {
                    var district = get_district_by_id(focusedDistrict);
                    clearFocus.textContent = district ? ('Clear focus: ' + district_title_text(district)) : 'Clear district focus';
                }
                clearFocus.style.display = 'inline-block';
            }

            function focus_district(mymap, markers, districtId) {
                if (sidebarState.focusDistrictId == districtId) {
                    clear_district_focus(mymap, markers, true);
                    return;
                }

                if (sidebarState.focusDistrictId) {
                    sidebarState.openDistricts[sidebarState.focusDistrictId] = false;
                }
                if (!sidebarState.focusDistrictId) {
                    sidebarState.preFocusView = {
                        center: mymap.getCenter(),
                        zoom: mymap.getZoom(),
                    };
                }
                sidebarState.focusDistrictId = districtId;
                sidebarState.openDistricts[districtId] = true;

                update_markers(mymap, markers);
                build_sidebar(mymap, markers);
                update_district_focus_ui();

                if (!sidebarState.focusDistrictId) return;

                if (districtId == '__unassigned') {
                    var points = [];
                    for (var marker_type in markers) {
                        for (var marker_i in markers[marker_type]["markers"]) {
                            var marker = markers[marker_type]["markers"][marker_i];
                            if (marker.tiles != tiles) continue;
                            if (marker._district_id) continue;
                            points.push(marker["coords"]);
                        }
                    }
                    if (points.length > 0) {
                        mymap.fitBounds(L.latLngBounds(points), {padding: [24, 24], maxZoom: 6});
                    }
                    return;
                }

                var district = get_district_by_id(districtId);
                if (district && district.path && district.path.length > 2) {
                    mymap.fitBounds(L.latLngBounds(district.path), {
                        padding: [24, 24],
                        maxZoom: 6,
                    });
                }
            }

            function clear_district_focus(mymap, markers, restoreView) {
                if (!sidebarState.focusDistrictId) return;
                var previousDistrictId = sidebarState.focusDistrictId;
                sidebarState.focusDistrictId = null;
                sidebarState.openDistricts[previousDistrictId] = false;
                update_markers(mymap, markers);
                build_sidebar(mymap, markers);
                update_district_focus_ui();
                if (restoreView && sidebarState.preFocusView) {
                    mymap.setView(sidebarState.preFocusView.center, sidebarState.preFocusView.zoom);
                }
                sidebarState.preFocusView = null;
            }

            function marker_matches_query(markers, marker_type, marker_i) {
                var q = get_search_query();
                if (!q) return true;

                var marker = markers[marker_type]["markers"][marker_i];

                var title = marker_title_text(marker, marker_type);
                var catTitle = marker_type;
                if (markers[marker_type]["title"] && language in markers[marker_type]["title"]) {
                    catTitle = markers[marker_type]["title"][language];
                }

                var desc = marker.description ? marker.description : '';

                var haystack = (title + ' ' + catTitle + ' ' + desc).toLowerCase();
                return haystack.indexOf(q) !== -1;
            }

            function update_markers(mymap, markers) {
                var marker_type;
                var showCompleted = get_show_completed();

                for (marker_type in markers) {
                    for (marker_i in markers[marker_type]["markers"]) {
                        var marker = markers[marker_type]["markers"][marker_i];
                        if (marker.tiles != tiles) {
                            continue;
                        }

                        var visibility = undefined;

                        // Base visibility comes from category show/hide.
                        if (marker._visibility != markers[marker_type].visibility) {
                            visibility = markers[marker_type].visibility;
                        }

                        // Hide completed if requested.
                        if (visibility !== 'hidden' && marker.completed && !showCompleted) {
                            visibility = 'hidden';
                        }

                        // Focus on a single district.
                        if (visibility !== 'hidden' && !marker_matches_focus(marker)) {
                            visibility = 'hidden';
                        }

                        // Search query filter.
                        if (visibility !== 'hidden' && !marker_matches_query(markers, marker_type, marker_i)) {
                            visibility = 'hidden';
                        }

                        if (visibility && marker._visibility != visibility) {
                            if (visibility == "visible") {
                                marker.marker.addTo(mymap);
                            } else if (visibility == "hidden") {
                                marker.marker.removeFrom(mymap);
                            }
                            marker._visibility = visibility;
                        }
                    }
                }
            }

            function update_label_visibility(mymap) {
                if (mymap.getZoom() >= 5) {
                    L.DomUtil.addClass(mymap.getContainer(), 'show-labels');
                } else {
                    L.DomUtil.removeClass(mymap.getContainer(), 'show-labels');
                }
            }

            function marker_title_text(marker, marker_type) {
                if (marker.title) {
                    if (marker.title.constructor == Object) {
                        if (language in marker.title) {
                            return marker.title[language];
                        }
                        return marker_type;
                    }
                    return marker.title;
                }
                return marker_type;
            }

            function get_show_cursor_coords() {
                var showCursorCoords = document.getElementById('showCursorCoords');
                if (!showCursorCoords) return false;
                return !!showCursorCoords.checked;
            }

            function format_coords(latlng) {
                return '[' + latlng.lat.toFixed(2) + ', ' + latlng.lng.toFixed(2) + ']';
            }

            function update_cursor_coords(latlng) {
                var el = document.getElementById('cursorCoords');
                if (!el) return;

                if (!get_show_cursor_coords()) {
                    el.style.display = 'none';
                    return;
                }

                el.style.display = 'block';
                if (latlng) {
                    el.textContent = 'Cursor: ' + format_coords(latlng);
                } else {
                    el.textContent = 'Cursor: --';
                }
            }

            function serialize_completed(markers) {
                var marker_type, marker_i;
                var completed = {};

                for (marker_type in markers) {
                    for (marker_i in markers[marker_type]["markers"]) {
                        if (markers[marker_type]["markers"][marker_i].completed) {
                            if (!completed[marker_type]) {
                                completed[marker_type] = [];
                            }
                            completed[marker_type].push(marker_i);
                        }
                    }
                }

                localStorage.setItem("completed", JSON.stringify(completed));
            }

            function set_marker_completed(mymap, markers, marker_type, marker_i, completed) {
                var marker = markers[marker_type]["markers"][marker_i];
                marker.completed = completed;
                serialize_completed(markers);
                update_markers(mymap, markers);
                update_toggle_all_button(markers);
                build_sidebar(mymap, markers);
            }

            function focus_marker(mymap, marker) {
                var zoom = mymap.getZoom();
                if (zoom < 5) {
                    zoom = 5;
                }
                mymap.setView(marker["coords"], zoom);
                if (marker.marker) {
                    marker.marker.openPopup();
                }
            }

            function maybe_zoom_to_search_results(mymap, markers) {
                var zoomToResults = document.getElementById('zoomToResults');
                if (!zoomToResults || !zoomToResults.checked) return;

                var q = get_search_query();
                if (!q) return;

                var points = [];
                for (var marker_type in markers) {
                    if (markers[marker_type].visibility != 'visible') continue;
                    for (var marker_i in markers[marker_type]["markers"]) {
                        var marker = markers[marker_type]["markers"][marker_i];
                        if (marker.tiles != tiles) continue;
                        if (!marker_matches_focus(marker)) continue;
                        if (!marker_matches_query(markers, marker_type, marker_i)) continue;
                        points.push(marker["coords"]);
                    }
                }

                if (points.length == 0) return;

                var bounds = L.latLngBounds(points);
                mymap.fitBounds(bounds, {
                    padding: [24, 24],
                    maxZoom: 6,
                });
            }

            function district_title_text(district) {
                if (!district) return '';
                if (!district.title) return district.id || 'District';
                if (district.title.constructor == Object) {
                    if (language in district.title) {
                        return district.title[language];
                    }
                    if ('en' in district.title) {
                        return district.title.en;
                    }
                    return district.id || 'District';
                }
                return district.title;
            }

            function marker_district_id(marker_type, marker_i) {
                if (!districtPointIndex || !districtPointIndex.pointDistrictById) return null;
                var lookupId = marker_type + ':' + marker_i;
                if (lookupId in districtPointIndex.pointDistrictById) {
                    return districtPointIndex.pointDistrictById[lookupId];
                }
                return null;
            }

            function get_marker_indices(markers, marker_type, includeCompleted, districtId) {
                var out = [];
                for (var marker_i in markers[marker_type]["markers"]) {
                    var marker = markers[marker_type]["markers"][marker_i];
                    if (marker.tiles != tiles) continue;
                    if (!marker_matches_focus(marker)) continue;
                    if (!marker_matches_query(markers, marker_type, marker_i)) continue;

                    if (districtId !== undefined && districtId !== null) {
                        var did = marker._district_id ? marker._district_id : '__unassigned';
                        if (did != districtId) continue;
                    }

                    if (!includeCompleted && marker.completed) continue;
                    out.push(marker_i);
                }
                return out;
            }

            function create_sidebar_entry(mymap, markers, marker_type, marker_i, includeCategoryLabel) {
                var marker = markers[marker_type]["markers"][marker_i];
                var entryId = marker_type + ':' + marker_i;

                var li = document.createElement('li');
                li.className = 'sidebar-entry';
                if (marker.completed) {
                    li.className += ' completed';
                }

                var row = document.createElement('div');
                row.className = 'sidebar-entry-row';

                var entryTitle = document.createElement('button');
                entryTitle.type = 'button';
                entryTitle.className = 'sidebar-entry-title';
                entryTitle.textContent = sidebar_entry_title_text(markers, marker, marker_type, includeCategoryLabel);
                entryTitle.addEventListener('click', function() {
                    var t = this.getAttribute('data-type');
                    var i = this.getAttribute('data-index');
                    focus_marker(mymap, markers[t]["markers"][i]);
                });
                entryTitle.setAttribute('data-type', marker_type);
                entryTitle.setAttribute('data-index', marker_i);

                var actions = document.createElement('div');
                actions.className = 'sidebar-entry-actions';

                var entryToggle = document.createElement('button');
                entryToggle.type = 'button';
                entryToggle.className = 'sidebar-entry-toggle';
                entryToggle.setAttribute('aria-label', 'Toggle details');
                entryToggle.textContent = sidebarState.openEntries[entryId] ? 'â–¾' : 'â–¸';
                entryToggle.addEventListener('click', function(ev) {
                    ev.preventDefault();
                    var t = this.getAttribute('data-type');
                    var i = this.getAttribute('data-index');
                    var id = t + ':' + i;
                    sidebarState.openEntries[id] = !sidebarState.openEntries[id];
                    build_sidebar(mymap, markers);
                });
                entryToggle.setAttribute('data-type', marker_type);
                entryToggle.setAttribute('data-index', marker_i);

                var locate = document.createElement('button');
                locate.type = 'button';
                locate.className = 'sidebar-action sidebar-action-icon';
                locate.setAttribute('aria-label', 'Show on map');
                locate.innerHTML = '&#x1F5FA;';
                locate.addEventListener('click', function(ev) {
                    ev.preventDefault();
                    var t = this.getAttribute('data-type');
                    var i = this.getAttribute('data-index');
                    focus_marker(mymap, markers[t]["markers"][i]);
                });
                locate.setAttribute('data-type', marker_type);
                locate.setAttribute('data-index', marker_i);

                var completeWrap = document.createElement('label');
                completeWrap.className = 'sidebar-complete';

                var complete = document.createElement('input');
                complete.type = 'checkbox';
                complete.checked = !!marker.completed;
                complete.addEventListener('change', function() {
                    var t = this.getAttribute('data-type');
                    var i = this.getAttribute('data-index');
                    set_marker_completed(mymap, markers, t, i, this.checked);
                });
                complete.setAttribute('data-type', marker_type);
                complete.setAttribute('data-index', marker_i);

                var completeLabel = document.createElement('span');
                completeLabel.textContent = 'Done';

                completeWrap.appendChild(complete);
                completeWrap.appendChild(completeLabel);

                actions.appendChild(entryToggle);
                actions.appendChild(locate);
                actions.appendChild(completeWrap);

                row.appendChild(entryTitle);
                row.appendChild(actions);

                var details = document.createElement('div');
                details.className = 'sidebar-entry-details';
                if (!sidebarState.openEntries[entryId]) {
                    details.style.display = 'none';
                }

                var coords = document.createElement('div');
                coords.className = 'sidebar-entry-coords';
                coords.textContent = 'Location: [' + marker["coords"][0].toFixed(2) + ', ' + marker["coords"][1].toFixed(2) + ']';

                var desc = document.createElement('div');
                desc.className = 'sidebar-entry-desc';
                if (marker.description) {
                    desc.innerHTML = marker.description;
                } else {
                    desc.textContent = '';
                }

                details.appendChild(coords);
                details.appendChild(desc);

                li.appendChild(row);
                li.appendChild(details);
                return li;
            }

            function update_district_visibility() {
                var visible = get_show_districts();
                for (var i = 0; i < districtLayers.length; i++) {
                    var layer = districtLayers[i];
                    if (visible) {
                        layer.setStyle({opacity: 0.95, fillOpacity: 0.12});
                    } else {
                        layer.setStyle({opacity: 0, fillOpacity: 0});
                    }
                }
            }

            function initialize_districts(mymap, districtsData) {
                districtLayers = [];
                activeDistricts = [];

                var districts = [];
                if (districtsData) {
                    if (districtsData.constructor == Array) {
                        districts = districtsData;
                    } else if (districtsData.districts && districtsData.districts.constructor == Array) {
                        districts = districtsData.districts;
                    }
                }

                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    if (!district || !district.path || district.path.length < 3) continue;

                    var districtTiles = district.tiles || 'main';
                    if (districtTiles != tiles) continue;

                    var latVals = [];
                    var lngVals = [];
                    for (var p = 0; p < district.path.length; p++) {
                        latVals.push(district.path[p][0]);
                        lngVals.push(district.path[p][1]);
                    }
                    district._bbox = {
                        lat_min: Math.min.apply(null, latVals),
                        lat_max: Math.max.apply(null, latVals),
                        lng_min: Math.min.apply(null, lngVals),
                        lng_max: Math.max.apply(null, lngVals),
                    };
                    activeDistricts.push(district);

                    var style = district.style || {};
                    var layer = L.polygon(district.path, {
                        pane: 'districtPane',
                        color: style.color || '#1f5fbf',
                        weight: style.weight || 2,
                        opacity: 0.95,
                        fillColor: style.fillColor || style.color || '#1f5fbf',
                        fillOpacity: 0.12,
                    }).addTo(mymap);

                    var title = district_title_text(district);
                    if (title) {
                        layer.bindTooltip(title, {
                            sticky: true,
                            direction: 'center',
                            className: 'district-label',
                        });
                    }

                    districtLayers.push(layer);
                }

                update_district_visibility();
            }

            function build_sidebar(mymap, markers) {
                var sidebar = document.getElementById('sidebarContent');
                if (!sidebar) return;

                var showCompleted = get_show_completed();
                var grouping = get_sidebar_grouping();

                sidebar.innerHTML = '';
                update_district_focus_ui();

                var markerTypes = Object.keys(markers);
                markerTypes.sort(function(a, b) {
                    var at = category_title_text(markers, a);
                    var bt = category_title_text(markers, b);
                    return at.localeCompare(bt, undefined, { sensitivity: 'base' });
                });

                if (grouping == 'district') {
                    var districtOrder = [];
                    for (var d = 0; d < activeDistricts.length; d++) {
                        districtOrder.push(activeDistricts[d].id);
                    }
                    districtOrder.sort(function(a, b) {
                        var da = null;
                        var db = null;
                        for (var i = 0; i < activeDistricts.length; i++) {
                            if (activeDistricts[i].id == a) da = activeDistricts[i];
                            if (activeDistricts[i].id == b) db = activeDistricts[i];
                        }
                        return district_title_text(da).localeCompare(district_title_text(db), undefined, { sensitivity: 'base' });
                    });
                    districtOrder.push('__unassigned');

                    for (var di = 0; di < districtOrder.length; di++) {
                        var districtId = districtOrder[di];
                        var districtObj = null;
                        if (districtId != '__unassigned') {
                            for (var ai = 0; ai < activeDistricts.length; ai++) {
                                if (activeDistricts[ai].id == districtId) {
                                    districtObj = activeDistricts[ai];
                                    break;
                                }
                            }
                        }

                        var districtTotal = 0;
                        var districtComplete = 0;
                        var districtVisibleEntries = [];
                        for (var ti = 0; ti < markerTypes.length; ti++) {
                            var typeId = markerTypes[ti];
                            var allIdx = get_marker_indices(markers, typeId, true, districtId);
                            if (allIdx.length == 0) continue;

                            districtTotal += allIdx.length;
                            for (var ci = 0; ci < allIdx.length; ci++) {
                                if (markers[typeId]["markers"][allIdx[ci]].completed) districtComplete += 1;
                            }

                            var visibleIdx = get_marker_indices(markers, typeId, showCompleted, districtId);
                            for (var viList = 0; viList < visibleIdx.length; viList++) {
                                districtVisibleEntries.push({
                                    marker_type: typeId,
                                    marker_i: visibleIdx[viList],
                                });
                            }
                        }

                        if (districtTotal == 0) continue;

                        var districtSection = document.createElement('section');
                        districtSection.className = 'sidebar-category';

                        var districtHeader = document.createElement('div');
                        districtHeader.className = 'sidebar-category-header';

                        var districtLeft = document.createElement('div');
                        districtLeft.className = 'sidebar-category-left';

                        var districtExpand = document.createElement('button');
                        districtExpand.className = 'sidebar-expand';
                        districtExpand.type = 'button';
                        districtExpand.setAttribute('aria-label', 'Toggle district');
                        districtExpand.textContent = sidebarState.openDistricts[districtId] ? 'â–¾' : 'â–¸';
                        districtExpand.setAttribute('data-district', districtId);
                        districtExpand.addEventListener('click', function(ev) {
                            ev.preventDefault();
                            var did = this.getAttribute('data-district');
                            sidebarState.openDistricts[did] = !sidebarState.openDistricts[did];
                            build_sidebar(mymap, markers);
                        });

                        var districtTitle = document.createElement('div');
                        districtTitle.className = 'sidebar-category-title';
                        districtTitle.textContent = districtId == '__unassigned' ? 'Unassigned' : district_title_text(districtObj);

                        var districtCounts = document.createElement('div');
                        districtCounts.className = 'sidebar-category-counts';
                        districtCounts.textContent = districtComplete + ' / ' + districtTotal;

                        var districtFocus = document.createElement('button');
                        districtFocus.type = 'button';
                        districtFocus.className = 'sidebar-top-action';
                        districtFocus.textContent = (get_focused_district_id() == districtId) ? 'Unfocus' : 'Focus';
                        districtFocus.setAttribute('data-district', districtId);
                        districtFocus.addEventListener('click', function(ev) {
                            ev.preventDefault();
                            focus_district(mymap, markers, this.getAttribute('data-district'));
                        });

                        var districtRight = document.createElement('div');
                        districtRight.className = 'sidebar-entry-actions';

                        districtLeft.appendChild(districtExpand);
                        districtLeft.appendChild(districtTitle);
                        districtHeader.appendChild(districtLeft);
                        districtRight.appendChild(districtCounts);
                        districtRight.appendChild(districtFocus);
                        districtHeader.appendChild(districtRight);
                        districtSection.appendChild(districtHeader);

                        var districtProgress = document.createElement('div');
                        districtProgress.className = 'sidebar-category-progress';
                        var districtFill = document.createElement('div');
                        districtFill.className = 'sidebar-category-progress-fill';
                        districtFill.style.width = ((districtComplete / districtTotal) * 100).toFixed(1) + '%';
                        districtProgress.appendChild(districtFill);
                        districtSection.appendChild(districtProgress);

                        var districtContent = document.createElement('div');
                        if (!sidebarState.openDistricts[districtId]) {
                            districtContent.style.display = 'none';
                        }
                        districtVisibleEntries.sort(function(a, b) {
                            var ac = category_title_text(markers, a.marker_type);
                            var bc = category_title_text(markers, b.marker_type);
                            var byCat = ac.localeCompare(bc, undefined, { sensitivity: 'base' });
                            if (byCat != 0) return byCat;

                            var am = markers[a.marker_type]["markers"][a.marker_i];
                            var bm = markers[b.marker_type]["markers"][b.marker_i];
                            var at = marker_title_text(am, a.marker_type);
                            var bt = marker_title_text(bm, b.marker_type);
                            return at.localeCompare(bt, undefined, { sensitivity: 'base' });
                        });

                        var districtList = document.createElement('ul');
                        districtList.className = 'sidebar-entry-list';
                        for (var dve = 0; dve < districtVisibleEntries.length; dve++) {
                            var entry = districtVisibleEntries[dve];
                            districtList.appendChild(create_sidebar_entry(mymap, markers, entry.marker_type, entry.marker_i, true));
                        }
                        districtContent.appendChild(districtList);

                        districtSection.appendChild(districtContent);
                        sidebar.appendChild(districtSection);
                    }
                    return;
                }

                for (var idx = 0; idx < markerTypes.length; idx++) {
                    var marker_type = markerTypes[idx];
                    var allIndices = get_marker_indices(markers, marker_type, true, null);
                    if (allIndices.length == 0) continue;

                    var completeCount = 0;
                    for (var c = 0; c < allIndices.length; c++) {
                        if (markers[marker_type]["markers"][allIndices[c]].completed) completeCount += 1;
                    }

                    var section = document.createElement('section');
                    section.className = 'sidebar-category';
                    if (markers[marker_type].visibility != 'visible') {
                        section.className += ' is-hidden';
                    }

                    var header = document.createElement('div');
                    header.className = 'sidebar-category-header';

                    var left = document.createElement('div');
                    left.className = 'sidebar-category-left';

                    var expand = document.createElement('button');
                    expand.className = 'sidebar-expand';
                    expand.type = 'button';
                    expand.setAttribute('aria-label', 'Toggle category');
                    expand.textContent = sidebarState.openCategories[marker_type] ? 'â–¾' : 'â–¸';
                    expand.setAttribute('data-type', marker_type);
                    expand.addEventListener('click', function(ev) {
                        ev.preventDefault();
                        var t = this.getAttribute('data-type');
                        sidebarState.openCategories[t] = !sidebarState.openCategories[t];
                        build_sidebar(mymap, markers);
                    });

                    var vis = document.createElement('button');
                    vis.type = 'button';
                    vis.className = 'sidebar-visibility';
                    vis.setAttribute('aria-label', 'Show/hide category on map');
                    vis.textContent = markers[marker_type].visibility == 'visible' ? 'ðŸ‘' : 'ðŸš«';
                    vis.setAttribute('data-type', marker_type);
                    vis.addEventListener('click', function(ev) {
                        ev.preventDefault();
                        var t = this.getAttribute('data-type');
                        markers[t].visibility = markers[t].visibility == 'visible' ? 'hidden' : 'visible';
                        update_markers(mymap, markers);
                        update_toggle_all_button(markers);
                        build_sidebar(mymap, markers);
                    });

                    var title = document.createElement('div');
                    title.className = 'sidebar-category-title';
                    title.textContent = category_title_text(markers, marker_type);

                    var counts = document.createElement('div');
                    counts.className = 'sidebar-category-counts';
                    counts.textContent = completeCount + ' / ' + allIndices.length;

                    left.appendChild(vis);
                    left.appendChild(expand);
                    left.appendChild(title);
                    header.appendChild(left);
                    header.appendChild(counts);
                    section.appendChild(header);

                    var progress = document.createElement('div');
                    progress.className = 'sidebar-category-progress';
                    var progressFill = document.createElement('div');
                    progressFill.className = 'sidebar-category-progress-fill';
                    progressFill.style.width = ((completeCount / allIndices.length) * 100).toFixed(1) + '%';
                    progress.appendChild(progressFill);
                    section.appendChild(progress);

                    var list = document.createElement('ul');
                    list.className = 'sidebar-entry-list';
                    if (!sidebarState.openCategories[marker_type]) {
                        list.style.display = 'none';
                    }

                    var visibleIndices = get_marker_indices(markers, marker_type, showCompleted, null);
                    for (var vi2 = 0; vi2 < visibleIndices.length; vi2++) {
                        list.appendChild(create_sidebar_entry(mymap, markers, marker_type, visibleIndices[vi2], false));
                    }

                    section.appendChild(list);
                    sidebar.appendChild(section);
                }
            }

            function onload() {
                var params = (new URL(document.location)).searchParams;
                language = params.get('language');
                if (!language) {
                    language = 'en';
                }
                debug = params.get('debug');
                if (!debug) {
                    debug = 0;
                }
                tiles = params.get('tiles');
                if (!tiles) {
                    tiles = 'main';
                }

                var mymap = L.map('mapid', {
                    maxBounds: [
                        [90, 180],
                        [-90, -180],
                    ],
                }).setView([0, 0], 2);

                L.tileLayer('tiles/' + tiles +'/{z}/{x}/{y}.png', {
                    maxNativeZoom: 4,
                    maxZoom: 10,
                }).addTo(mymap);
                mymap.createPane('districtPane');
                mymap.getPane('districtPane').style.zIndex = 350;

                update_label_visibility(mymap);
                mymap.on('zoomend', function () {
                    update_label_visibility(mymap);
                });
                mymap.on('mousemove', function(e) {
                    update_cursor_coords(e.latlng);
                });
                mymap.on('mouseout', function() {
                    update_cursor_coords(null);
                });

                var popup = L.popup();
                if (debug) {
                    mymap.on('click', function (e) {
                        popup
                            .setLatLng(e.latlng)
                            .setContent(
                                "{\"coords\": [" +
                                e.latlng.lat.toFixed(2) +
                                ", " +
                                e.latlng.lng.toFixed(2) +
                                "]},"
                            )
                            .openOn(mymap);
                    });
                }

                var hideCompleted = document.getElementById('hideCompleted');
                if (hideCompleted) {
                    hideCompleted.addEventListener('change', function() {
                        // update_markers/build_sidebar will run after markers load.
                        // This handler is useful after completion state changes.
                    });
                }

                var sidebarToggle = document.getElementById('sidebarToggle');
                if (sidebarToggle) {
                    sidebarToggle.addEventListener('click', function() {
                        var app = document.getElementById('app');
                        if (L.DomUtil.hasClass(app, 'sidebar-open')) {
                            L.DomUtil.removeClass(app, 'sidebar-open');
                        } else {
                            L.DomUtil.addClass(app, 'sidebar-open');
                        }
                        setTimeout(function() {
                            mymap.invalidateSize();
                        }, 220);
                    });
                }

                Promise.all([
                    fetch('markers.json').then(function(response) { return response.json(); }),
                    fetch('districts.json')
                        .then(function(response) {
                            if (!response.ok) return {districts: []};
                            return response.json();
                        })
                        .catch(function() { return {districts: []}; }),
                    fetch('district-points.json')
                        .then(function(response) {
                            if (!response.ok) return null;
                            return response.json();
                        })
                        .catch(function() { return null; }),
                ]).then(function(result) {
                    var markers = result[0];
                    var districtsData = result[1];
                    districtPointIndex = result[2];
                    if (districtPointIndex && districtPointIndex.points && districtPointIndex.points.constructor == Array) {
                        districtPointIndex.pointDistrictById = {};
                        for (var pi = 0; pi < districtPointIndex.points.length; pi++) {
                            var point = districtPointIndex.points[pi];
                            if (!point || !point.id) continue;
                            var districtIds = point.district_ids || [];
                            districtPointIndex.pointDistrictById[point.id] = districtIds.length ? districtIds[0] : null;
                        }
                    }

                    initialize_districts(mymap, districtsData);
                    initialize(mymap, markers);
                    show_district_validation_badge();

                    var search = document.getElementById('sidebarSearch');
                    if (search) {
                        search.addEventListener('input', function() {
                            update_markers(mymap, markers);
                            build_sidebar(mymap, markers);
                            maybe_zoom_to_search_results(mymap, markers);
                        });
                    }
                });
            }

            function update_toggle_all_button(markers) {
                var btn = document.getElementById('toggleAll');
                if (!btn || !markers) return;

                var anyVisible = false;
                var allHidden = true;
                for (var marker_type in markers) {
                    if (markers[marker_type].visibility == 'visible') {
                        anyVisible = true;
                        allHidden = false;
                    } else {
                        // keep allHidden true
                    }
                }

                if (!anyVisible || allHidden) {
                    btn.textContent = 'Show all';
                    btn.setAttribute('data-mode', 'show');
                } else {
                    btn.textContent = 'Hide all';
                    btn.setAttribute('data-mode', 'hide');
                }
            }

            function initialize(mymap, markers) {
                var completed = JSON.parse(localStorage.getItem("completed"));
                if (!completed) completed = {};

                for (marker_type in markers) {
                    var icon = L.icon({iconUrl: 'icons/'+marker_type+'.png', iconSize: [32, 32]});

                    // marker_type defaults
                    markers[marker_type].visibility = "visible";

                    for (marker_i in markers[marker_type]["markers"]) {
                        var marker = markers[marker_type]["markers"][marker_i];

                        // marker defaults
                        marker._visibility = "visible";
                        if (!marker.tiles) {
                            marker.tiles = "main";
                        }
                        marker._marker_type = marker_type;
                        marker._marker_i = marker_i;
                        marker._district_id = marker_district_id(marker_type, marker_i);
                        if (marker.tiles != tiles) {
                            continue;
                        }
                        if (completed[marker_type]) {
                            marker.completed = completed[marker_type].indexOf(marker_i) != -1;
                        }

                        marker.marker = L.marker(marker["coords"], {icon: icon}).addTo(mymap);

                        var container = L.DomUtil.create('div');
                        var title = L.DomUtil.create('h1', '', container);
                        var title_text = marker_title_text(marker, marker_type);

                        title.innerHTML = title_text;
                        if (!marker.title && debug) {
                            title.innerHTML += " " + marker["coords"]; 
                        }

                        marker._title_text = title_text;

                        marker.marker.bindTooltip(title_text, {
                            permanent: true,
                            direction: 'right',
                            className: 'marker-label',
                        });

                        L.DomUtil.create('br', '', container);

                        var description = L.DomUtil.create('div', '', container);
                        if (marker.description) description.innerHTML = marker.description;

                        L.DomUtil.create('br', '', container);

                        var complete = L.DomUtil.create('a', '', container);
                        complete.href = '#';
                        complete.innerHTML = 'complete';
                        complete.id = 'complete';

                        if (marker.completed) {
                            L.DomUtil.addClass(container, "completed");
                        }

                        L.DomEvent.disableClickPropagation(complete);
                        L.DomEvent.on(complete, 'click', function() {
                            var popup = this.marker.getPopup();
                            var container = popup.getContent();

                            var nextCompleted = !L.DomUtil.hasClass(container, 'completed');
                            if (nextCompleted) {
                                L.DomUtil.addClass(container, 'completed');
                            } else {
                                L.DomUtil.removeClass(container, 'completed');
                            }
                            popup.update();

                            set_marker_completed(mymap, markers, this._marker_type, this._marker_i, nextCompleted);
                        }, marker);

                        marker.marker.bindPopup(container);
                    }
                }

                update_markers(mymap, markers);

                var hideCompleted = document.getElementById('hideCompleted');
                if (hideCompleted) {
                    hideCompleted.addEventListener('change', function() {
                        update_markers(mymap, markers);
                        update_toggle_all_button(markers);
                        build_sidebar(mymap, markers);
                        maybe_zoom_to_search_results(mymap, markers);
                    });
                }

                var zoomToResults = document.getElementById('zoomToResults');
                if (zoomToResults) {
                    zoomToResults.addEventListener('change', function() {
                        maybe_zoom_to_search_results(mymap, markers);
                    });
                }

                var showCursorCoords = document.getElementById('showCursorCoords');
                if (showCursorCoords) {
                    showCursorCoords.addEventListener('change', function() {
                        update_cursor_coords(null);
                    });
                    update_cursor_coords(null);
                }

                var showDistricts = document.getElementById('showDistricts');
                if (showDistricts) {
                    showDistricts.addEventListener('change', function() {
                        update_district_visibility();
                    });
                }

                var clearDistrictFocus = document.getElementById('clearDistrictFocus');
                if (clearDistrictFocus) {
                    clearDistrictFocus.addEventListener('click', function(ev) {
                        ev.preventDefault();
                        clear_district_focus(mymap, markers, true);
                    });
                    update_district_focus_ui();
                }

                var sidebarTabs = document.querySelectorAll('.sidebar-tab');
                if (sidebarTabs && sidebarTabs.length > 0) {
                    for (var sti = 0; sti < sidebarTabs.length; sti++) {
                        sidebarTabs[sti].addEventListener('click', function(ev) {
                            ev.preventDefault();
                            var allTabs = document.querySelectorAll('.sidebar-tab');
                            for (var ti = 0; ti < allTabs.length; ti++) {
                                L.DomUtil.removeClass(allTabs[ti], 'is-active');
                            }
                            L.DomUtil.addClass(this, 'is-active');
                            build_sidebar(mymap, markers);
                        });
                    }
                }

                var toggleAll = document.getElementById('toggleAll');
                if (toggleAll) {
                    toggleAll.addEventListener('click', function(ev) {
                        ev.preventDefault();
                        var mode = toggleAll.getAttribute('data-mode');
                        var marker_type;
                        for (marker_type in markers) {
                            markers[marker_type].visibility = (mode == 'show') ? 'visible' : 'hidden';
                        }
                        update_markers(mymap, markers);
                        update_toggle_all_button(markers);
                        build_sidebar(mymap, markers);
                    });
                }

                update_toggle_all_button(markers);
                build_sidebar(mymap, markers);

            }
        </script>
        <style>
            .cf:before,
            .cf:after {
                content: " ";
                display: table;
            }
            .cf:after {
                clear: both;
            }

            html, body {
                height: 100%;
            }

            body {
                margin: 0;
                padding: 0;
            }

            #app {
                height: 100%;
                display: flex;
                flex-direction: row;
            }

            #mapid {
                flex: 1;
                height: 100%;
                min-width: 0;
                position: relative;
            }

            .sidebar {
                width: 360px;
                max-width: 90vw;
                height: 100%;
                background: rgba(255, 255, 255, 0.94);
                border-right: 1px solid rgba(0,0,0,0.12);
                box-shadow: 0 0 18px rgba(0,0,0,0.12);
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            .sidebar-site-title {
                padding: 12px 12px 10px 12px;
                font: 800 18px/22px Arial, Helvetica, sans-serif;
                letter-spacing: 0.4px;
                color: #111;
                background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(245,245,245,0.92));
                border-bottom: 1px solid rgba(0,0,0,0.10);
            }

            .sidebar-header {
                padding: 10px 12px;
                border-bottom: 1px solid rgba(0,0,0,0.10);
                background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(250,250,250,0.90));
            }

            .sidebar-header h2 {
                margin: 0;
                font: 600 14px/18px Arial, Helvetica, sans-serif;
                letter-spacing: 0.2px;
            }

            .sidebar-filters {
                margin-top: 8px;
                font: 13px/16px Arial, Helvetica, sans-serif;
                color: #222;
                display: flex;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
            }

            .sidebar-search {
                flex: 1 1 140px;
                min-width: 120px;
                border: 1px solid rgba(0,0,0,0.14);
                background: rgba(255,255,255,0.95);
                border-radius: 9px;
                padding: 6px 10px;
                font: 12px/14px Arial, Helvetica, sans-serif;
            }

            .sidebar-search:focus {
                outline: none;
                border-color: rgba(0,0,0,0.28);
                box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.06);
            }

            .sidebar-tabs {
                display: inline-flex;
                border: 1px solid rgba(0,0,0,0.14);
                border-radius: 9px;
                overflow: hidden;
                background: rgba(255,255,255,0.95);
            }

            .sidebar-tab {
                border: none;
                border-right: 1px solid rgba(0,0,0,0.10);
                background: transparent;
                padding: 6px 10px;
                font: 12px/14px Arial, Helvetica, sans-serif;
                cursor: pointer;
                white-space: nowrap;
            }

            .sidebar-tab:last-child {
                border-right: none;
            }

            .sidebar-tab.is-active {
                background: rgba(0,0,0,0.10);
                font-weight: 700;
            }

            .sidebar-filters label {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                user-select: none;
            }

            .sidebar-top-action {
                border: 1px solid rgba(0,0,0,0.14);
                background: rgba(255,255,255,0.95);
                border-radius: 9px;
                padding: 6px 10px;
                cursor: pointer;
                font: 12px/14px Arial, Helvetica, sans-serif;
                white-space: nowrap;
            }

            .sidebar-top-action:hover {
                background: rgba(255,255,255,1);
            }

            #sidebarContent {
                padding: 10px 12px;
                overflow: auto;
                flex: 1;
            }

            .sidebar-category {
                border: 1px solid rgba(0,0,0,0.10);
                border-radius: 8px;
                margin-bottom: 10px;
                background: rgba(255,255,255,0.85);
            }

            .sidebar-category.is-hidden {
                opacity: 0.65;
            }

            .sidebar-category-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                padding: 8px 10px;
                border-bottom: 1px solid rgba(0,0,0,0.08);
            }

            .sidebar-category-left {
                display: flex;
                align-items: center;
                gap: 8px;
                min-width: 0;
            }

            .sidebar-expand {
                width: 24px;
                height: 24px;
                border-radius: 6px;
                border: 1px solid rgba(0,0,0,0.14);
                background: rgba(255,255,255,0.9);
                cursor: pointer;
                font: 700 14px/20px Arial, Helvetica, sans-serif;
            }

            .sidebar-visibility {
                width: 28px;
                height: 28px;
                border-radius: 7px;
                border: 1px solid rgba(0,0,0,0.14);
                background: rgba(255,255,255,0.9);
                padding: 0;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font: 14px/1 Arial, Helvetica, sans-serif;
            }

            .sidebar-visibility:hover {
                background: rgba(255,255,255,1);
            }

            .sidebar-category-title {
                font: 700 15px/18px Arial, Helvetica, sans-serif;
                color: #111;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .sidebar-category-counts {
                font: 12px/16px Arial, Helvetica, sans-serif;
                color: #555;
                white-space: nowrap;
            }

            .sidebar-category-progress {
                height: 4px;
                margin: 0 10px 8px 10px;
                background: rgba(0,0,0,0.08);
                border-radius: 999px;
                overflow: hidden;
            }

            .sidebar-category-progress-fill {
                height: 100%;
                width: 0;
                background: linear-gradient(90deg, rgba(42, 122, 59, 0.9), rgba(42, 122, 59, 0.65));
                border-radius: 999px;
            }

            .sidebar-entry-list {
                list-style: none;
                margin: 0;
                padding: 0;
            }

            .sidebar-entry {
                border-top: 1px solid rgba(0,0,0,0.07);
            }

            .sidebar-entry-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 10px;
                padding: 10px 10px;
            }

            .sidebar-entry-title {
                flex: 1;
                text-align: left;
                border: none;
                background: transparent;
                padding: 0;
                cursor: pointer;
                font: 600 14px/18px Arial, Helvetica, sans-serif;
                color: #1c2a33;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .sidebar-entry.completed .sidebar-entry-title {
                text-decoration: line-through;
                color: #6a6a6a;
            }

            .sidebar-entry-coords {
                color: #666;
                font-family: monospace;
                font-size: 11px;
                line-height: 14px;
                white-space: nowrap;
                margin-top: 8px;
            }

            .sidebar-entry-desc {
                font: 12px/16px Arial, Helvetica, sans-serif;
                color: #333;
                margin-top: 8px;
            }

            .sidebar-entry-actions {
                display: inline-flex;
                gap: 10px;
                align-items: center;
                flex-wrap: nowrap;
                flex-shrink: 0;
            }

            .sidebar-entry-toggle {
                width: 24px;
                height: 24px;
                border-radius: 6px;
                border: 1px solid rgba(0,0,0,0.14);
                background: rgba(255,255,255,0.9);
                padding: 0;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font: 700 14px/1 Arial, Helvetica, sans-serif;
                color: #1c2a33;
            }

            .sidebar-entry-toggle:hover {
                background: rgba(255,255,255,1);
                color: #000;
            }

            .sidebar-entry-details {
                padding: 0 10px 12px 10px;
            }

            .sidebar-action {
                border: 1px solid rgba(0,0,0,0.14);
                background: rgba(255,255,255,0.9);
                border-radius: 7px;
                padding: 6px 8px;
                cursor: pointer;
                font: 12px/14px Arial, Helvetica, sans-serif;
            }

            .sidebar-action-icon {
                width: 30px;
                height: 30px;
                padding: 0;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                line-height: 1;
            }

            .sidebar-complete {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                user-select: none;
                font: 12px/16px Arial, Helvetica, sans-serif;
                color: #1c2a33;
            }

            .sidebar-complete input {
                width: 16px;
                height: 16px;
                accent-color: #2a7a3b;
            }

            .sidebar-entry.completed .sidebar-complete {
                color: #2a7a3b;
                font-weight: 600;
            }

            .info {
                padding: 6px 8px;
                font: 14px/16px Arial, Helvetica, sans-serif;
                background: white;
                background: rgba(255,255,255,0.8);
                box-shadow: 0 0 15px rgba(0,0,0,0.2);
                border-radius: 5px;
            }

            li.disabled {
                filter: grayscale(100%);
                text-decoration: line-through;
            }

            #forkme {
                z-index: 1000;
                right: 0;
                position: absolute;
            }

            .selected {
                text-decoration: none !important;
            }

            .completed #complete {
                text-decoration: line-through;
            }

            .leaflet-tooltip.marker-label {
                display: none;
                pointer-events: none;
                background: rgba(255, 255, 255, 0.9);
                border: 1px solid #aaa;
                color: #222;
                box-shadow: 0 1px 3px rgba(0,0,0,0.25);
            }

            #mapid.show-labels .leaflet-tooltip.marker-label {
                display: block;
            }

            .leaflet-tooltip.district-label {
                background: rgba(255, 255, 255, 0.9);
                border: 1px solid rgba(0,0,0,0.25);
                color: #1f2b44;
                box-shadow: 0 1px 3px rgba(0,0,0,0.2);
                font: 600 12px/14px Arial, Helvetica, sans-serif;
            }

            #sidebarToggle {
                display: none;
                position: absolute;
                z-index: 1100;
                left: 10px;
                top: 10px;
                border: 1px solid rgba(0,0,0,0.18);
                background: rgba(255,255,255,0.92);
                border-radius: 9px;
                padding: 8px 10px;
                font: 12px/14px Arial, Helvetica, sans-serif;
                cursor: pointer;
                box-shadow: 0 3px 10px rgba(0,0,0,0.20);
            }

            .cursor-coords {
                display: none;
                position: absolute;
                right: 10px;
                bottom: 10px;
                z-index: 1000;
                border: 1px solid rgba(0,0,0,0.18);
                background: rgba(255,255,255,0.92);
                border-radius: 8px;
                padding: 6px 10px;
                font: 12px/14px monospace;
                color: #111;
                box-shadow: 0 2px 8px rgba(0,0,0,0.16);
                pointer-events: none;
            }

            @media screen and (max-width: 900px) {
                #sidebarToggle {
                    display: block;
                }

                .sidebar {
                    position: absolute;
                    left: 0;
                    top: 0;
                    bottom: 0;
                    z-index: 1050;
                    transform: translateX(-102%);
                    transition: transform 200ms ease;
                }

                #app.sidebar-open .sidebar {
                    transform: translateX(0);
                }
            }

        </style>
    </head>
    <body onload="onload()">
        <a class="github-fork-ribbon" href="https://github.com/dstancioff/legocityundercovermap" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
        <button id="sidebarToggle" type="button">List</button>
        <div id="app">
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-site-title">Lego City Compuper</div>
                <div class="sidebar-header">
                    <h2>Items</h2>
                    <div class="sidebar-filters">
                        <input id="sidebarSearch" class="sidebar-search" type="search" placeholder="Search..." autocomplete="off" spellcheck="false">
                        <div class="sidebar-tabs" role="tablist" aria-label="Sidebar grouping">
                            <button type="button" class="sidebar-tab is-active" data-grouping="category">Category</button>
                            <button type="button" class="sidebar-tab" data-grouping="district">District</button>
                        </div>
                        <button id="toggleAll" type="button" class="sidebar-top-action">Hide all</button>
                        <button id="clearDistrictFocus" type="button" class="sidebar-top-action" style="display:none">Clear district focus</button>
                        <label>
                            <input id="hideCompleted" type="checkbox" checked>
                            <span>Hide completed</span>
                        </label>
                        <label>
                            <input id="zoomToResults" type="checkbox">
                            <span>Zoom to results</span>
                        </label>
                        <label>
                            <input id="showDistricts" type="checkbox">
                            <span>Show districts</span>
                        </label>
                        <label>
                            <input id="showCursorCoords" type="checkbox" checked>
                            <span>Show cursor coords</span>
                        </label>
                    </div>
                </div>
                <div id="sidebarContent"></div>
            </aside>
            <div id="mapid">
                <div id="cursorCoords" class="cursor-coords">Cursor: --</div>
            </div>
        </div>
    </body>
</html>
